<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>提示词填空器 (Prompt Fill Tool) V0.4.4</title>
    
    <!-- 1. 错误捕获 (防白屏机制) -->
    <style>
        #debug-console { display: none; position: fixed; bottom: 0; left: 0; right: 0; height: 120px; background: #111; color: #f55; font-family: monospace; font-size: 10px; overflow: auto; z-index: 9999; padding: 10px; opacity: 0.95; }
    </style>
    <div id="debug-console"><strong>System Error Log:</strong><br></div>
    <script>
        function logErr(msg) {
            const el = document.getElementById('debug-console');
            el.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            el.style.display = 'block';
            console.error(msg);
        }
        window.onerror = function(msg, url, line, col, error) {
            logErr(`Global: ${msg} (${line}:${col})`);
            document.getElementById('loading-text').innerText = "程序出错，请截图底部日志联系开发者";
            document.getElementById('loading-text').style.color = "red";
            return false;
        };
    </script>

    <!-- 2. 国内高速 CDN -->
    <script src="https://cdn.staticfile.net/tailwindcss/3.4.1/js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: { 50:'#eef2ff', 100:'#e0e7ff', 500:'#6366f1', 600:'#4f46e5', 700:'#4338ca' } },
                    boxShadow: { 'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)' }
                }
            }
        }
    </script>
    <script crossorigin src="https://cdn.staticfile.net/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.staticfile.net/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <!-- 使用字节跳动 Babel 源 -->
    <script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/babel-standalone/6.26.0/babel.min.js"></script>
    <script src="https://cdn.staticfile.net/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; overscroll-behavior-y: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; height: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .animate-enter { animation: enter 0.2s ease-out forwards; }
        @keyframes enter { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans h-[100dvh] w-full overflow-hidden flex flex-col">
    
    <div id="root" class="h-full w-full flex flex-col items-center justify-center space-y-4">
        <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"></div>
        <p id="loading-text" class="text-gray-500 text-sm">正在加载完整资源 (Full Features)...</p>
    </div>

    <script type="text/babel" data-presets="env,react">
        try {
            const { useState, useEffect, useMemo, useRef } = React;

            // --- Icons ---
            const Icon = ({ path, size = 18, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>
            );
            const Icons = {
                Edit3: (p) => <Icon {...p} path={<><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></>} />,
                Database: (p) => <Icon {...p} path={<><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></>} />,
                Layout: (p) => <Icon {...p} path={<><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></>} />,
                Plus: (p) => <Icon {...p} path={<><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></>} />,
                Trash2: (p) => <Icon {...p} path={<><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></>} />,
                Copy: (p) => <Icon {...p} path={<><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></>} />,
                Download: (p) => <Icon {...p} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></>} />,
                ChevronDown: (p) => <Icon {...p} path={<polyline points="6 9 12 15 18 9"/>} />,
                Code: (p) => <Icon {...p} path={<><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></>} />,
                Check: (p) => <Icon {...p} path={<polyline points="20 6 9 17 4 12"/>} />,
                User: (p) => <Icon {...p} path={<><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} />,
                Activity: (p) => <Icon {...p} path={<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>} />,
                Image: (p) => <Icon {...p} path={<><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></>} />,
                Package: (p) => <Icon {...p} path={<><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></>} />,
                MapPin: (p) => <Icon {...p} path={<><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></>} />
            };

            const VAR_GROUPS = {
                character: { label: "人物 (CHARACTER)", keys: ["role", "subject", "character_companion", "expressions"], icon: "User", color: "border-blue-500" },
                action: { label: "动作 (ACTION)", keys: ["grid_pose", "action_detail", "action_pose"], icon: "Activity", color: "border-green-500" },
                visuals: { label: "画面 (VISUALS)", keys: ["layout_focus", "camera_angle", "connectors", "texture_zoom", "special_view", "art_style", "background_style", "lens_param", "lighting"], icon: "Image", color: "border-purple-500" },
                item: { label: "物品 (ITEM)", keys: ["underwear_style", "clothing", "clothing_male", "clothing_female", "bag_content", "cosmetics", "private_items", "fashion_deconstruct", "toy_companion", "sticker_core", "sticker_decor"], icon: "Package", color: "border-orange-500" },
                location: { label: "地点 (LOCATION)", keys: ["background_scene"], icon: "MapPin", color: "border-red-500" }
            };

            // 数据定义
            const DEFAULT_DATA = {
                templates: [
                    { id: 't1', title: '角色概念分解图', content: `Role (角色设定)\n你是一位顶尖的 {{role}} ，擅长制作详尽的角色设定图。你特别擅长通过 {{subject}} 的私密物品、随身物件和生活细节来侧面丰满人物性格与背景故事。\n\nVisual Guidelines (视觉规范)\n1. 构图布局: 中心位放置角色的 {{layout_focus}} 。\n2. 拆解内容:\n•服装分层: 例如： {{clothing}}\n•私密内着: 例如： {{underwear_style}}\n•表情集: 如： {{expressions}}\n\nStyle:\n•画风: {{art_style}}\n•灯光: {{lighting}}` },
                    { id: 't2', title: '3x3 摄影网格', content: `创建一个 3x3 的摄影网格，展示 {{subject}} 的不同角度。\n风格: {{art_style}}\n光线: {{lighting}}\n每个格子应该展示: {{action_pose}}` }
                ],
                options: {
                    role: ["游戏概念设计师", "时尚摄影师", "电影导演"],
                    subject: ["赛博朋克黑客", "森林精灵", "都市白领", "机甲战士"],
                    art_style: ["2D 插画", "吉卜力风格", "写实摄影"],
                    layout_focus: ["全身立绘", "半身像", "头部特写"],
                    lighting: ["自然光", "赛博霓虹", "伦勃朗光"],
                    clothing: ["机能风外套", "丝绸长裙", "战术背心"],
                    underwear_style: ["运动内衣", "蕾丝套装", "简约棉质"],
                    expressions: ["冷漠", "狂喜", "羞涩"]
                }
            };

            function safeGet(key, defaultVal) {
                try { return JSON.parse(localStorage.getItem(key)) || defaultVal; } catch(e) { return defaultVal; }
            }

            function App() {
                const [templates, setTemplates] = useState(() => safeGet('pf_templates_v4', DEFAULT_DATA.templates));
                const [options, setOptions] = useState(() => safeGet('pf_options_v4', DEFAULT_DATA.options));
                const [activeId, setActiveId] = useState(() => localStorage.getItem('pf_active_id') || 't1');
                const [values, setValues] = useState(() => safeGet('pf_values_v4', {}));
                
                const [tab, setTab] = useState('fill'); // templates, fill, config
                const [mode, setMode] = useState('fill'); // fill, code

                useEffect(() => {
                    localStorage.setItem('pf_templates_v4', JSON.stringify(templates));
                    localStorage.setItem('pf_options_v4', JSON.stringify(options));
                    localStorage.setItem('pf_active_id', activeId);
                    localStorage.setItem('pf_values_v4', JSON.stringify(values));
                }, [templates, options, activeId, values]);

                const activeTpl = useMemo(() => templates.find(t => t.id === activeId) || templates[0] || {id:'err',content:''}, [templates, activeId]);

                const vars = useMemo(() => {
                    const found = new Set();
                    const regex = /\{\{([^}]+)\}\}/g;
                    let m;
                    while ((m = regex.exec(activeTpl.content)) !== null) found.add(m[1].trim());
                    return Array.from(found);
                }, [activeTpl.content]);

                const groupedVars = useMemo(() => {
                    const g = { other: [] };
                    Object.keys(VAR_GROUPS).forEach(k => g[k] = []);
                    vars.forEach(v => {
                        let matched = false;
                        for(const [gk, gc] of Object.entries(VAR_GROUPS)) {
                            if(gc.keys.includes(v)) { g[gk].push(v); matched=true; break; }
                        }
                        if(!matched) g.other.push(v);
                    });
                    return g;
                }, [vars]);

                const genText = useMemo(() => {
                    let t = activeTpl.content || "";
                    vars.forEach(v => t = t.split(`{{${v}}}`).join(values[v] || `{{${v}}`));
                    return t;
                }, [activeTpl.content, values, vars]);

                const handleCopy = () => { navigator.clipboard.writeText(genText).then(()=>alert('已复制')); };
                const handleSaveImg = async () => {
                    const el = document.getElementById('preview-content');
                    if(!el) return;
                    try {
                        const cvs = await html2canvas(el, {scale:2, backgroundColor:'#fff'});
                        const link = document.createElement('a');
                        link.download = `Prompt_${activeTpl.title}.png`;
                        link.href = cvs.toDataURL();
                        link.click();
                    } catch(e) { alert('生成失败'); }
                };

                return (
                    <div className="flex flex-col h-full bg-gray-50 text-gray-800">
                        <div className="flex-1 flex overflow-hidden">
                            
                            {/* Left Sidebar (Templates) */}
                            <div className={`${tab==='templates'?'translate-x-0 z-20':'-translate-x-full lg:translate-x-0'} fixed inset-0 lg:static bg-white lg:w-72 lg:border-r border-gray-200 transition-transform duration-300 flex flex-col shadow-xl lg:shadow-none`}>
                                <div className="p-4 border-b flex justify-between items-center bg-gray-50">
                                    <h1 className="font-bold text-primary-600">提示词填空器 <span className="text-[10px] bg-primary-100 px-1 rounded">V0.4.4</span></h1>
                                    <button className="lg:hidden" onClick={()=>setTab('fill')}><Icons.ChevronDown size={20} className="rotate-90 text-gray-400"/></button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar">
                                    {templates.map(t => (
                                        <div key={t.id} onClick={()=>{setActiveId(t.id); if(window.innerWidth<1024) setTab('fill');}} 
                                            className={`p-3 rounded-lg border cursor-pointer flex justify-between group ${t.id===activeTpl.id?'bg-primary-50 border-primary-200 shadow-sm':'bg-white border-transparent hover:bg-gray-50'}`}>
                                            <div className="font-medium text-sm truncate">{t.title}</div>
                                            {t.id===activeTpl.id && <button onClick={(e)=>{e.stopPropagation(); if(confirm('删除?')) setTemplates(ts=>ts.filter(x=>x.id!==t.id));}} className="text-gray-300 hover:text-red-500"><Icons.Trash2 size={14}/></button>}
                                        </div>
                                    ))}
                                </div>
                                <div className="p-3 border-t"><button onClick={()=>{
                                    const nid='t'+Date.now(); setTemplates([...templates, {id:nid, title:'新模版', content:'新的 Prompt...'}]); setActiveId(nid);
                                }} className="w-full py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg text-sm flex justify-center items-center gap-2 transition-colors"><Icons.Plus size={16}/> 新建模版</button></div>
                            </div>

                            {/* Center (Fill/Editor) */}
                            <div className={`${tab==='config'?'hidden lg:flex':'flex'} flex-1 flex-col bg-white relative overflow-hidden`}>
                                <div className="h-14 border-b flex items-center justify-between px-4 bg-white shrink-0">
                                    <div className="flex bg-gray-100 p-1 rounded-lg">
                                        <button onClick={()=>setMode('fill')} className={`px-3 py-1 text-xs rounded font-medium transition-all ${mode==='fill'?'bg-white shadow text-primary-600':'text-gray-500'}`}>交互填空</button>
                                        <button onClick={()=>setMode('code')} className={`px-3 py-1 text-xs rounded font-medium transition-all ${mode==='code'?'bg-white shadow text-primary-600':'text-gray-500'}`}>源码编辑</button>
                                    </div>
                                    <div className="flex gap-2">
                                        <button onClick={handleSaveImg} className="hidden lg:flex px-3 py-1.5 text-gray-600 hover:bg-gray-100 rounded-lg text-xs gap-1 items-center font-medium"><Icons.Download size={14}/> 长图</button>
                                        <button onClick={handleCopy} className="bg-black text-white px-3 py-1.5 rounded-lg text-xs flex gap-1 items-center font-medium hover:bg-gray-800 transition-colors"><Icons.Copy size={14}/> 复制</button>
                                    </div>
                                </div>

                                <div className="flex-1 flex overflow-hidden">
                                    {mode === 'code' ? (
                                        <div className="w-full h-full flex flex-col">
                                            <input className="border-b px-6 py-3 text-sm font-bold text-gray-700 outline-none focus:bg-gray-50" value={activeTpl.title} onChange={e=>setTemplates(ts=>ts.map(t=>t.id===activeTpl.id?{...t, title:e.target.value}:t))} placeholder="模版标题..." />
                                            <textarea className="flex-1 p-6 font-mono text-sm resize-none focus:outline-none bg-gray-50 leading-relaxed" 
                                                value={activeTpl.content} onChange={e=>setTemplates(ts => ts.map(t=>t.id===activeTpl.id?{...t, content:e.target.value}:t))} />
                                        </div>
                                    ) : (
                                        <div className="flex flex-col lg:flex-row w-full h-full">
                                            {/* Input Area */}
                                            <div className="flex-1 lg:max-w-[420px] overflow-y-auto p-4 custom-scrollbar bg-gray-50/50 border-r pb-24 lg:pb-4">
                                                {/* Mobile Preview Widget */}
                                                <div className="lg:hidden mb-4 bg-white p-3 rounded-xl border border-indigo-100 shadow-sm text-xs text-gray-600 max-h-32 overflow-y-auto break-all">
                                                    <div className="flex justify-between items-center mb-1 text-[10px] text-indigo-400 font-bold tracking-wider"><span>PREVIEW</span><span onClick={handleCopy} className="text-gray-400">COPY</span></div>
                                                    <HighlightText text={genText} values={values} />
                                                </div>
                                                
                                                <div className="space-y-6">
                                                    {Object.entries(groupedVars).map(([gk, gvs]) => {
                                                        if(!gvs.length) return null;
                                                        const ginfo = VAR_GROUPS[gk] || {label:'其他变量', icon:'Settings', color:'border-gray-400'};
                                                        return (
                                                            <div key={gk} className="space-y-2 animate-enter">
                                                                <h3 className="text-[10px] font-bold text-gray-400 uppercase tracking-wider pl-1 flex items-center gap-1">
                                                                    {ginfo.label}
                                                                </h3>
                                                                {gvs.map(v => (
                                                                    <InputWithDropdown key={v} label={v} value={values[v]||''} 
                                                                        onChange={val=>setValues(old=>({...old, [v]:val}))} 
                                                                        options={options[v]||[]} color={ginfo.color} />
                                                                ))}
                                                            </div>
                                                        )
                                                    })}
                                                    {!vars.length && <div className="text-center py-10 text-gray-400 text-xs">暂无变量，请切换到源码模式添加 {`{{...}}`}</div>}
                                                </div>
                                            </div>
                                            {/* PC Preview Area */}
                                            <div className="hidden lg:block flex-1 p-8 overflow-y-auto bg-gray-100 custom-scrollbar">
                                                <div id="preview-content" className="bg-white p-10 rounded-xl shadow-sm min-h-[600px] whitespace-pre-wrap font-mono text-sm leading-loose border border-gray-200 text-gray-700">
                                                    <HighlightText text={genText} values={values} />
                                                    <div className="mt-8 pt-4 border-t text-[10px] text-gray-300 flex justify-between">
                                                        <span>Prompt Fill Tool</span>
                                                        <span>Generated by AI</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                            
                            {/* Right Config (Mobile Tab / PC Modal) */}
                            <div className={`${tab==='config'?'translate-x-0 z-20':'-translate-x-full lg:hidden'} fixed inset-0 bg-white transition-transform duration-300 flex flex-col`}>
                                <div className="p-4 border-b flex justify-between items-center bg-gray-50"><h2 className="font-bold">词库配置</h2></div>
                                <div className="flex-1 overflow-y-auto p-4 custom-scrollbar">
                                    <ConfigPanel options={options} setOptions={setOptions} />
                                </div>
                            </div>

                            {/* PC Config Slide-over */}
                            <div className={`hidden lg:flex fixed right-0 top-0 bottom-0 w-80 bg-white border-l shadow-2xl transform transition-transform duration-300 flex-col z-30 ${tab==='config'?'translate-x-0':'translate-x-full'}`}>
                                <div className="p-4 border-b flex justify-between items-center bg-gray-50">
                                    <h2 className="font-bold">词库配置</h2>
                                    <button onClick={()=>setTab('fill')}><Icons.Check size={20}/></button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-4 custom-scrollbar">
                                    <ConfigPanel options={options} setOptions={setOptions} />
                                </div>
                            </div>

                            {/* PC Config Toggle Button (Floating) */}
                            <div className="hidden lg:block absolute bottom-6 right-6 z-20">
                                <button onClick={()=>setTab(tab==='config'?'fill':'config')} className="bg-white p-3 rounded-full shadow-lg border hover:bg-gray-50 text-gray-600 transition-all">
                                    <Icons.Database size={24}/>
                                </button>
                            </div>
                        </div>

                        {/* Mobile Bottom Nav */}
                        <div className="lg:hidden h-16 bg-white border-t flex justify-around items-center shrink-0 pb-safe z-50">
                            <NavBtn label="模版" active={tab==='templates'} onClick={()=>setTab('templates')} Icon={Icons.Layout}/>
                            <NavBtn label="填空" active={tab==='fill'} onClick={()=>setTab('fill')} Icon={Icons.Edit3}/>
                            <NavBtn label="词库" active={tab==='config'} onClick={()=>setTab('config')} Icon={Icons.Database}/>
                        </div>
                    </div>
                );
            }

            // --- Sub Components ---

            function InputWithDropdown({ label, value, onChange, options, color }) {
                const [show, setShow] = useState(false);
                const ref = useRef(null);
                useEffect(()=>{
                    const h=e=>{if(ref.current&&!ref.current.contains(e.target))setShow(false)};
                    document.addEventListener('mousedown',h);return ()=>document.removeEventListener('mousedown',h);
                },[]);

                return (
                    <div ref={ref} className={`relative bg-white border rounded-xl p-2 pl-3 shadow-sm transition-all ${show?'border-indigo-400 ring-2 ring-indigo-50 z-10':'border-gray-200'} ${color.replace('border','border-l-4')}`}>
                        <label className="text-[10px] text-gray-400 block font-bold mb-0.5">{label}</label>
                        <div className="flex items-center">
                            <input value={value} onChange={e=>onChange(e.target.value)} onFocus={()=>setShow(true)}
                                className="w-full text-sm outline-none bg-transparent placeholder-gray-200" placeholder="输入..." />
                            <button onClick={()=>setShow(!show)} className="p-1 text-gray-300 hover:text-indigo-500"><Icons.ChevronDown size={14}/></button>
                        </div>
                        {show && options.length > 0 && (
                            <div className="absolute top-full left-0 right-0 mt-1 bg-white border rounded-xl shadow-xl max-h-40 overflow-y-auto z-50 custom-scrollbar animate-enter">
                                {options.map((o,i)=>(
                                    <div key={i} onClick={()=>{onChange(o); setShow(false);}} className="px-3 py-2 text-sm hover:bg-indigo-50 cursor-pointer text-gray-700 truncate">{o}</div>
                                ))}
                            </div>
                        )}
                    </div>
                );
            }

            function ConfigPanel({ options, setOptions }) {
                const [key, setKey] = useState(Object.keys(options)[0] || '');
                const [val, setVal] = useState('');
                const add = () => { if(val.trim()){ setOptions(p=>({...p, [key]:[...(p[key]||[]), val.trim()]})); setVal(''); }};
                return (
                    <div className="space-y-4">
                        <div className="flex flex-wrap gap-2">
                            {Object.keys(options).map(k=>(
                                <button key={k} onClick={()=>setKey(k)} className={`px-2 py-1 text-xs rounded border ${key===k?'bg-gray-800 text-white':'bg-white text-gray-600'}`}>{k}</button>
                            ))}
                        </div>
                        <div className="bg-gray-50 p-4 rounded-xl border">
                            <h3 className="text-xs font-bold text-gray-500 mb-2 uppercase">{key} ({options[key]?.length})</h3>
                            <div className="flex gap-2 mb-3">
                                <input value={val} onChange={e=>setVal(e.target.value)} onKeyDown={e=>e.key==='Enter'&&add()} className="flex-1 text-sm px-3 py-2 rounded border focus:outline-none focus:border-indigo-500" placeholder="添加候选项..." />
                                <button onClick={add} className="bg-indigo-600 text-white px-3 rounded"><Icons.Plus size={18}/></button>
                            </div>
                            <div className="space-y-1 max-h-[300px] overflow-y-auto custom-scrollbar">
                                {options[key]?.map((o,i)=>(
                                    <div key={i} className="flex justify-between items-center bg-white p-2 rounded border group">
                                        <span className="text-sm text-gray-700">{o}</span>
                                        <button onClick={()=>setOptions(p=>({...p, [key]:p[key].filter((_,idx)=>idx!==i)}))} className="text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100"><Icons.Trash2 size={14}/></button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            function HighlightText({ text, values }) {
                if(!text) return null;
                const parts = text.split(/(\{\{[^}]+\}\})/g);
                return (
                    <span>
                        {parts.map((part, i) => {
                            if (part.startsWith('{{') && part.endsWith('}}')) {
                                const k = part.slice(2, -2).trim();
                                const val = values[k];
                                return <span key={i} className={`mx-0.5 px-1 rounded transition-colors ${val?'bg-indigo-50 text-indigo-700 font-bold border-b border-indigo-200':'bg-yellow-50 text-yellow-600 border-b border-dashed border-yellow-300'}`}>{val || part}</span>
                            }
                            return <span key={i}>{part}</span>
                        })}
                    </span>
                );
            }

            function NavBtn({ label, active, onClick, Icon }) {
                return (
                    <button onClick={onClick} className={`flex flex-col items-center justify-center w-full h-full space-y-1 ${active ? 'text-indigo-600' : 'text-gray-400'}`}>
                        <Icon size={22} className={active ? 'stroke-[2.5px]' : ''}/>
                        <span className="text-[10px] font-medium">{label}</span>
                    </button>
                )
            }

            ReactDOM.createRoot(document.getElementById('root')).render(<App />);
        } catch (error) {
            console.error(error);
            document.getElementById('loading-text').innerText = "Crash: " + error.message;
        }
    </script>
</body>
</html>